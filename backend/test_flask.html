<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flask Backend - Cooking Modes Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen p-8">
    <div class="max-w-2xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-900 mb-8">Flask Backend - Cooking Modes</h1>
        
        <!-- Add Pantry Item -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Add Pantry Item</h2>
            <div class="flex gap-4 mb-4">
                <input 
                    type="text" 
                    id="itemName" 
                    placeholder="Item name" 
                    class="flex-1 px-3 py-2 border border-gray-300 rounded-md"
                >
                <input 
                    type="number" 
                    id="itemQuantity" 
                    placeholder="Quantity" 
                    value="1"
                    class="w-20 px-3 py-2 border border-gray-300 rounded-md"
                >
                <input 
                    type="text" 
                    id="itemUnit" 
                    placeholder="Unit" 
                    value="pieces"
                    class="w-20 px-3 py-2 border border-gray-300 rounded-md"
                >
                <button 
                    onclick="addPantryItem()" 
                    class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700"
                >
                    Add
                </button>
            </div>
        </div>

        <!-- Current Pantry -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Current Pantry</h2>
            <div id="pantryList" class="space-y-2">
                <!-- Will be populated by JavaScript -->
            </div>
            <button onclick="loadPantry()" class="mt-4 px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700">
                Refresh Pantry
            </button>
        </div>

        <!-- Recipe Generation -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Generate Recipe</h2>
            
            <!-- Cooking Mode Selector -->
            <div class="mb-4">
                <p class="text-sm font-medium text-gray-700 mb-2">Choose Recipe Style:</p>
                <div class="flex gap-4">
                    <label class="flex items-center gap-2">
                        <input type="radio" name="cookingMode" value="home" checked class="text-blue-600">
                        üç≥ Home Cooked
                    </label>
                    <label class="flex items-center gap-2">
                        <input type="radio" name="cookingMode" value="professional" class="text-orange-600">
                        üë®‚Äçüç≥ Professional
                    </label>
                </div>
            </div>

            <button 
                onclick="generateRecipe()" 
                class="px-6 py-3 bg-green-600 text-white rounded-md hover:bg-green-700 font-semibold"
            >
                Generate Recipe
            </button>
        </div>

        <!-- Recipe Result -->
        <div id="recipeResult" class="bg-white rounded-lg shadow-md p-6 hidden">
            <h2 class="text-xl font-semibold mb-4">Generated Recipe</h2>
            <div id="recipeContent">
                <!-- Will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://127.0.0.1:5001';

        // Load pantry items
        async function loadPantry() {
            try {
                const response = await fetch(`${API_BASE}/api/pantry`);
                const data = await response.json();
                
                const pantryList = document.getElementById('pantryList');
                if (data.success && data.data.length > 0) {
                    pantryList.innerHTML = data.data.map(item => 
                        `<div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                            <span>${item.name} (${item.quantity} ${item.unit})</span>
                            <button onclick="deletePantryItem(${item.id})" class="text-red-600 hover:text-red-800">Delete</button>
                        </div>`
                    ).join('');
                } else {
                    pantryList.innerHTML = '<p class="text-gray-500">No pantry items found</p>';
                }
            } catch (error) {
                console.error('Error loading pantry:', error);
            }
        }

        // Add pantry item
        async function addPantryItem() {
            const name = document.getElementById('itemName').value.trim();
            const quantity = parseInt(document.getElementById('itemQuantity').value) || 1;
            const unit = document.getElementById('itemUnit').value.trim() || 'pieces';

            if (!name) {
                alert('Please enter an item name');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/pantry/add`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ name, quantity, unit, category: 'other' }),
                });

                const data = await response.json();
                if (data.success) {
                    document.getElementById('itemName').value = '';
                    document.getElementById('itemQuantity').value = '1';
                    document.getElementById('itemUnit').value = 'pieces';
                    loadPantry();
                } else {
                    alert('Error adding item: ' + data.error);
                }
            } catch (error) {
                console.error('Error adding pantry item:', error);
                alert('Error adding item');
            }
        }

        // Delete pantry item
        async function deletePantryItem(id) {
            try {
                const response = await fetch(`${API_BASE}/api/pantry/delete/${id}`, {
                    method: 'DELETE',
                });

                const data = await response.json();
                if (data.success) {
                    loadPantry();
                } else {
                    alert('Error deleting item');
                }
            } catch (error) {
                console.error('Error deleting pantry item:', error);
                alert('Error deleting item');
            }
        }

        // Generate recipe
        async function generateRecipe() {
            const mode = document.querySelector('input[name="cookingMode"]:checked').value;
            
            try {
                const response = await fetch(`${API_BASE}/api/meal-plan`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ cookingMode: mode }),
                });

                const data = await response.json();
                
                if (data.success) {
                    displayRecipe(data.data, mode);
                } else {
                    alert('Error generating recipe: ' + data.error);
                }
            } catch (error) {
                console.error('Error generating recipe:', error);
                alert('Error generating recipe');
            }
        }

        // Display recipe
        function displayRecipe(recipeData, mode) {
            const resultDiv = document.getElementById('recipeResult');
            const contentDiv = document.getElementById('recipeContent');
            
            const meals = recipeData.meals || [];
            const modeIcon = mode === 'professional' ? 'üë®‚Äçüç≥' : 'üç≥';
            const modeText = mode === 'professional' ? 'Professional' : 'Home Cook';
            
            contentDiv.innerHTML = `
                <div class="mb-4 p-3 bg-blue-50 rounded-lg">
                    <p class="text-blue-800 font-semibold">${modeIcon} ${modeText} Mode Recipe</p>
                </div>
                ${meals.map((meal, index) => `
                    <div class="mb-6 p-4 border border-gray-200 rounded-lg">
                        <h3 class="text-lg font-semibold mb-2">${meal.title}</h3>
                        <p class="text-gray-600 mb-3">${meal.description}</p>
                        
                        ${meal.ingredientsUsed && meal.ingredientsUsed.length > 0 ? `
                            <div class="mb-3">
                                <h4 class="font-medium text-green-700 mb-1">From Your Pantry:</h4>
                                <div class="flex flex-wrap gap-1">
                                    ${meal.ingredientsUsed.map(ing => `<span class="bg-green-100 text-green-800 px-2 py-1 rounded text-sm">${ing}</span>`).join('')}
                                </div>
                            </div>
                        ` : ''}
                        
                        ${meal.missingIngredients && meal.missingIngredients.length > 0 ? `
                            <div class="mb-3">
                                <h4 class="font-medium text-orange-700 mb-1">Need to Buy:</h4>
                                <div class="flex flex-wrap gap-1">
                                    ${meal.missingIngredients.map(ing => `<span class="bg-orange-100 text-orange-800 px-2 py-1 rounded text-sm">${ing}</span>`).join('')}
                                </div>
                            </div>
                        ` : ''}
                        
                        ${meal.steps && meal.steps.length > 0 ? `
                            <div class="mb-3">
                                <h4 class="font-medium text-gray-700 mb-2">Cooking Instructions:</h4>
                                <ol class="space-y-1">
                                    ${meal.steps.map((step, idx) => `
                                        <li class="flex gap-2">
                                            <span class="w-6 h-6 bg-blue-500 text-white rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0">${idx + 1}</span>
                                            <span class="text-sm">${step}</span>
                                        </li>
                                    `).join('')}
                                </ol>
                            </div>
                        ` : ''}
                        
                        <div class="text-sm text-gray-600 mt-3 pt-3 border-t">
                            ${meal.cookTime ? `‚è±Ô∏è ${meal.cookTime} ‚Ä¢ ` : ''}
                            ${meal.nutrition ? `üî• ${meal.nutrition.calories} cal, ü•© ${meal.nutrition.protein} protein` : ''}
                        </div>
                    </div>
                `).join('')}
            `;
            
            resultDiv.classList.remove('hidden');
        }

        // Load pantry on page load
        window.addEventListener('load', loadPantry);
    </script>
</body>
</html>
